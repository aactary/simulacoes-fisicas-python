{% extends 'manu/base.html' %}
{% load static %}

{% block title %}{{ simulation.title }} - Simulações Físicas com Python{% endblock %}

{% block extra_css %}
<style>
    .simulation-controls {
        position: sticky;
        top: 120px;
        z-index: 100;
    }
    
    .parameter-slider {
        margin-bottom: 1rem;
    }
    
    .parameter-value {
        font-weight: 600;
        color: var(--primary-blue);
    }
    
    .simulation-running {
        border: 2px solid var(--accent-green);
        box-shadow: 0 0 20px rgba(5, 150, 105, 0.3);
    }
    
    .code-tabs .nav-link {
        color: var(--gray-600);
        border: none;
        background: var(--gray-100);
        margin-right: 0.25rem;
        border-radius: 0.5rem 0.5rem 0 0;
    }
    
    .code-tabs .nav-link.active {
        background: var(--gray-900);
        color: white;
    }
    
    .formula-container {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(255, 255, 255, 1) 100%);
        border: 2px solid rgba(37, 99, 235, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        margin: 1rem 0;
    }
    
    .lesson-objective {
        background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(255, 255, 255, 1) 100%);
        border-left: 4px solid var(--accent-green);
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 0 0.5rem 0.5rem 0;
    }

    .list-group-item.list-group-item-action:hover:not(:disabled) {
        background-color: #e9ecef;
        cursor: pointer;
    }

    .list-group-item.list-group-item-success {
        background-color: #d1e7dd; /* Cor de sucesso do Bootstrap */
        border-color: #badbcc;
    }

    .list-group-item.list-group-item-danger {
        background-color: #f8d7da; /* Cor de perigo do Bootstrap */
        border-color: #f5c2c7;
    }

    #question {
        line-height: 1.5;
    }

    /* Estilo para matemática com LaTeX */
    #question, .list-group-item {
        font-family: 'Times New Roman', serif;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header da Simulação -->
<div class="simulation-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg">
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb text-white-50">
                        <li class="breadcrumb-item">
                            <a href="{% url 'simulacoes:index' %}" class="text-white-50 text-decoration-none">
                                <i class="bi bi-house me-1"></i>Início
                            </a>
                        </li>
                        <li class="breadcrumb-item active text-white" aria-current="page">
                            {{ simulation.category|default:"Mecânica" }}
                        </li>
                    </ol>
                </nav>
                <h1 class="display-5 fw-bold mb-3">
                    <i class="bi bi-{{ simulation.icon }} me-3"></i>
                    {{ simulation.title|default:"Lançamento de Projéteis" }}
                </h1>
                <p class="lead mb-0">
                    {{ simulation.description|default:"Explore os conceitos fundamentais do movimento oblíquo através de simulações interativas e visualizações em tempo real." }}
                </p>
            </div>
            <!-- <div class="col-lg-4 text-lg-end">
                <div class="simulation-status bg-dark bg-opacity-20 rounded-3 p-3">
                    <div class="d-flex align-items-center justify-content-center">
                        <div class="status-indicator bg-success rounded-circle me-2" style="width: 12px; height: 12px;"></div>
                        <span class="fw-semibold">Simulação Ativa</span>
                    </div>
                    <small class="d-block mt-1 opacity-75">
                        Última atualização: {{ simulation.updated_at|default:"15/01/2024" }}
                    </small>
                </div>
            </div> -->
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="row">
        <!-- Coluna Principal - Simulação e Visualização -->
        <div class="col-lg">
            <!-- Controles da Simulação -->
            <div class="simulation-section mb-4">
                <h3>
                    <i class="bi bi-sliders"></i>
                    Parâmetros da Simulação
                </h3>
                <div class="parameters-form">
                    <!-- <form id="simulationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="parameter-slider">
                                    <label for="velocity" class="form-label d-flex justify-content-between">
                                        <span>Velocidade Inicial (m/s)</span>
                                        <span class="parameter-value" id="velocityValue">10</span>
                                    </label>
                                    <input type="range" class="form-range" id="velocity" min="0" max="50" value="10" step="0.5">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="parameter-slider">
                                    <label for="time" class="form-label d-flex justify-content-between">
                                        <span>Tempo de Simulação (s)</span>
                                        <span class="parameter-value" id="timeValue">10</span>
                                    </label>
                                    <input type="range" class="form-range" id="time" min="1" max="30" value="10" step="0.5">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="parameter-slider">
                                    <label for="position" class="form-label d-flex justify-content-between">
                                        <span>Posição Inicial (m)</span>
                                        <span class="parameter-value" id="positionValue">0</span>
                                    </label>
                                    <input type="range" class="form-range" id="position" min="-50" max="50" value="0" step="1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="parameter-slider">
                                    <label for="mass" class="form-label d-flex justify-content-between">
                                        <span>Massa do Objeto (kg)</span>
                                        <span class="parameter-value" id="massValue">1</span>
                                    </label>
                                    <input type="range" class="form-range" id="mass" min="0.1" max="10" value="1" step="0.1">
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex gap-3">
                                    <button type="button" class="btn btn-simulate" id="startSimulation">
                                        <i class="bi bi-play-fill me-2"></i>
                                        Iniciar Simulação
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="pauseSimulation">
                                        <i class="bi bi-pause-fill me-2"></i>
                                        Pausar
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" id="resetSimulation">
                                        <i class="bi bi-arrow-clockwise me-2"></i>
                                        Reiniciar
                                    </button>
                                    <button type="button" class="btn btn-outline-info" id="exportData">
                                        <i class="bi bi-download me-2"></i>
                                        Exportar Dados
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form> -->
                    
                    <form method="get" class="row g-3 align-items-end">
                        <div class="row">
                            <div class="col-md">
                                <label for="velocidade" class="form-label">Velocidade (m/s)</label>
                                <input type="number" name="velocidade" step="0.1" value="{{velocidade}}" class="form-control form-control-lg" id="velocidade">
                            </div>

                            <div class="col-md">
                                <label for="angulo" class="form-label">Ângulo (graus)</label>
                                <input type="number" name="angulo" step="1" value="{{angulo}}" class="form-control form-control-lg" id="angulo">
                            </div>

                            <div class="col-md">
                                <label for="gravidade" class="form-label">Gravidade (m/s²)</label>
                                <input type="number" name="gravidade" step="0.1" value="{{gravidade}}" class="form-control form-control-lg" id="gravidade">
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex gap-3">
                                    <button type="submit" class="btn btn-simulate" id="startSimulation">
                                        <i class="bi bi-play-fill me-2"></i>
                                        Iniciar Simulação
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" disabled id="pauseSimulation">
                                        <i class="bi bi-pause-fill me-2"></i>
                                        Pausar
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" disabled id="resetSimulation">
                                        <i class="bi bi-arrow-clockwise me-2"></i>
                                        Reiniciar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Área de Visualização -->
            <div class="simulation-section mb-4">
                <h3>
                    <i class="bi bi-graph-up"></i>
                    Visualização da Simulação
                </h3>
                <div class="row">
                    <div class="col-12">
                        <!-- Animação do Movimento -->
                        <div class="visualization-area mb-4" id="animationArea">
                            {% if imagem_grafico %}
                            {{imagem_grafico|safe}}
                            {% else %}
                            <div class="text-center">
                                <i class="bi bi-play-circle fs-1 text-muted mb-3"></i>
                                <h5 class="text-muted">Clique em "Iniciar Simulação" para visualizar o movimento</h5>
                                <p class="text-muted">A animação mostrará o objeto em movimento retilíneo uniforme</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                
                <!-- Dados em Tempo Real -->
                <div class="real-time-data bg-light rounded-3 p-3">
                    <h6 class="mb-3">
                        <i class="bi bi-speedometer2 me-2"></i>
                        Dados da Simulação
                    </h6>
                    <div class="row text-center">
                        <div class="col-md">
                            <div class="data-item">
                                <div class="data-value fs-4 fw-bold text-primary" id="currentTime">{{altura_maxima}} m</div>
                                <div class="data-label text-muted">Altura Máxima</div>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="data-item">
                                <div class="data-value fs-4 fw-bold text-success" id="currentPosition">{{alcance}} m</div>
                                <div class="data-label text-muted">Distância Total</div>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="data-item">
                                <div class="data-value fs-4 fw-bold text-info" id="currentVelocity">{{tempo_total}} s</div>
                                <div class="data-label text-muted">Tempo</div>
                            </div>
                        </div>
                        <!-- <div class="col-md-3">
                            <div class="data-item">
                                <div class="data-value fs-4 fw-bold text-warning" id="currentDistance">0.0</div>
                                <div class="data-label text-muted">Distância (m)</div>
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>

            <!-- Fórmulas Matemáticas -->
            <div class="simulation-section mb-4">
                <h3>
                    <i class="bi bi-calculator"></i>
                    Fórmulas Matemáticas
                </h3>
                <div class="formula-container">
                    <!-- <h5 class="text-center mb-4 text-primary">Movimento Retilíneo Uniforme</h5> -->
                    
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="formula-block mb-3">
                                <h6 class="text-center mb-2">Altura Máxima $h_{max}$</h6>
                                <div class="formula-math text-center">
                                    $$ \dfrac{v_0^2 \sin^2 (\theta)}{2g}$$
                                </div>
                                <small class="text-muted d-block text-center mt-2">
                                    Onde: $v_0$ = velocidade incial, $\theta$ = ângulo, $g$ = gravidade
                                </small>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="formula-block mb-3">
                                <h6 class="text-center mb-2">Alcance $R$</h6>
                                <div class="formula-math text-center">
                                    $$R = \dfrac{v_0^2 \sin (2 \theta)}{g} $$
                                </div>
                                <small class="text-muted d-block text-center mt-2">
                                    Onde: $v_0$ = velocidade incial, $\theta$ = ângulo, $g$ = gravidade
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="formula-block mb-3">
                                <h6 class="text-center mb-2">Tempo total de voo $T$</h6>
                                <div class="formula-math text-center">
                                    $$ T = \dfrac{2v_0 \sin(\theta)}{g} $$
                                </div>
                                <small class="text-muted d-block text-center mt-2">
                                   Onde: $v_0$ = velocidade incial, $\theta$ = ângulo, $g$ = gravidade
                                </small>
                            </div>
                        </div>
                        <!-- <div class="col-lg-6">
                            <div class="formula-block mb-3">
                                <h6 class="text-center mb-2">Condição para MRU</h6>
                                <div class="formula-math text-center">
                                    $$a = 0 \Rightarrow v = \text{constante}$$
                                </div>
                                <small class="text-muted d-block text-center mt-2">
                                    No MRU, a aceleração é zero e a velocidade permanece constante
                                </small>
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>

            <!-- Código da Aplicação -->
            <div class="simulation-section mb-4">
                <h3>
                    <i class="bi bi-code-slash"></i>
                    Anexos
                </h3>
                <div class="code-section">
                    <ul class="nav nav-tabs" id="codeTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="python-tab" data-bs-toggle="tab" data-bs-target="#python-code" type="button" role="tab">
                                <i class="bi bi-file-code me-1"></i>
                                Plano de Aula
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="javascript-tab" data-bs-toggle="tab" data-bs-target="#javascript-code" type="button" role="tab">
                                <i class="bi bi-filetype-py me-1"></i>
                                Código Fonte
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="html-tab" data-bs-toggle="tab" data-bs-target="#html-code" type="button" role="tab">
                                <i class="bi bi-filetype-html me-1"></i>
                                Exercícios
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="codeTabsContent">
                        <div class="tab-pane fade show active" id="python-code" role="tabpanel">
                            <div class="">
                                <!--  -->
                                <h4><i class="bi bi-pin-angle-fill"></i> ROTEIRO DE AULA: Simulação Computacional de Lançamento de Projéteis</h4>
        
                                <ul>
                                    <li><strong>Série:</strong> 2ª ou 3ª série do Ensino Médio</li>
                                    <li><strong>Duração:</strong> 2 aulas (50 minutos cada)</li>
                                    <li><strong>Área:</strong> Ciências da Natureza e suas Tecnologias</li>
                                    <li><strong>Disciplina:</strong> Física</li>
                                </ul>
        
                                <h5>1. Tema da Aula:</h5>
                                <p>Simulação Computacional de Lançamento de Projéteis: analisando altura e distância máxima.</p>
        
                                <h5>2. Objetivos de Aprendizagem:</h5>
                                <ul>
                                    <li>Compreender o movimento de projéteis sob ação da gravidade.</li>
                                    <li>Aplicar equações da cinemática em duas dimensões.</li>
                                    <li>Interpretar graficamente os resultados da simulação.</li>
                                    <li>Desenvolver habilidades de resolução de problemas com uso de tecnologia.</li>
                                </ul>
        
                                <h5>3. Habilidades da BNCC (Ciências da Natureza):</h5>
                                <ul>
                                    <li>EM13CNT102 – Analisar e/ou simular o movimento de objetos com base em leis e princípios da mecânica clássica.</li>
                                    <li>EM13CNT103 – Resolver problemas com ou sem uso de tecnologias digitais, envolvendo movimentos de corpos.</li>
                                    <li>EM13CNT104 – Investigar e analisar movimentos utilizando linguagens matemáticas e computacionais.</li>
                                    <li>EM13CNT301 – Utilizar ferramentas computacionais para modelar situações-problema e interpretar dados.</li>
                                </ul>
        
                                <h5>4. Conteúdos Abordados:</h5>
                                <ul>
                                    <li>Movimento oblíquo (2D)</li>
                                    <li>Componentes horizontal e vertical da velocidade</li>
                                    <li>Equações da cinemática</li>
                                </ul>
        
                                <h5>5. Metodologia:</h5>
                                <h6>Aula 1: Contextualização e Fundamentos</h6>
                                <ul>
                                    <li>Introdução ao movimento de projéteis: exemplos do cotidiano.</li>
                                    <li>Apresentação das equações da cinemática em duas dimensões.</li>
                                    <li>Discussão: o que é simulação? Por que simular um fenômeno físico?</li>
                                    <li>Alunos, em duplas, ajustam parâmetros e observam resultados.</li>
                                </ul>
        
                                <h6>Aula 2: Exploração, Interpretação e Avaliação</h6>
                                <ul>
                                    <li>Execução da simulação com diferentes valores.</li>
                                    <li>Análise de gráficos: altura x tempo, distância x tempo, trajetória.</li>
                                    <li>Discussão em grupo: como a simulação se aproxima da realidade?</li>
                                    <li>Desafios (ex: "Qual ângulo dá maior alcance?")</li>
                                    <li>Reflexão sobre o uso da programação como ferramenta científica.</li>
                                </ul>
        
                                <h5>6. Recursos Didáticos:</h5>
                                <ul>
                                    <li>Computadores com acesso à internet</li>
                                    <li>Projetor multimídia</li>
                                    <li>Quadro branco</li>
                                    <li>Simulação Computacional</li>
                                </ul>
        
                                <h5>7. Avaliação:</h5>
                                <ul>
                                    <li>Participação e discussões.</li>
                                    <li>Resolução de problema prático ao final.</li>
                                    <li>Entrega de relatório contendo:</li>
                                    <ul>
                                        <li>Print da simulação</li>
                                        <li>Análise dos resultados</li>
                                        <li>Reflexão do aprendizado</li>
                                    </ul>
                                </ul>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="javascript-code" role="tabpanel">
                            <div class="mt-4">
                                <h5>Google Colab Notebook</h5>
                                <p>Acesse o código-fonte clicando no link abaixo:</p>

                                <a href="https://colab.research.google.com/drive/17dO5FpsauIJRmUcIHDb-jMAZBPuVVIFJ?usp=sharing" target="_blank" rel="noopener">
                                    <img style="width: 200px; height: auto;" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Abrir no Google Colab" />
                                </a>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="html-code" role="tabpanel">
                            <div class="mt-4">
                                <div class="container-fluid py-5">
                                    <div class="row justify-content-center">
                                        <div class="col-12 col-md-8 col-lg-6">
                                            <div class="card shadow-lg border-0 rounded-3">
                                                <div class="card-body p-4 p-md-5">
                                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                                        <h2 class="card-title text-center text-primary fw-bold flex-grow-1">Quiz: Lançamento de Projéteis</h2>
                                                        <span class="badge bg-primary fs-6" id="question-number"></span>
                                                    </div>
                                                    
                                                    <div class="progress mb-4" role="progressbar" aria-label="Progresso do Quiz" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                                        <div class="progress-bar" id="progress-bar"></div>
                                                    </div>

                                                    <div class="question-container mb-4">
                                                        <p class="fs-4 fw-medium text-dark" id="question"></p>
                                                    </div>
                                                    
                                                    <div class="options-container list-group" id="answer-buttons">
                                                        </div>

                                                    <div class="feedback-container mt-4" style="display: none;" id="feedback-area">
                                                        <div class="alert alert-info py-2" role="alert">
                                                            <small class="text-secondary fw-semibold">Dica:</small> <span id="hint-text"></span>
                                                        </div>
                                                        <div class="alert py-2" role="alert" id="rationale-alert">
                                                            <small class="fw-semibold" id="rationale-label"></small> <span id="rationale-text"></span>
                                                        </div>
                                                    </div>

                                                    <div class="d-grid gap-2 mt-4">
                                                        <button class="btn btn-primary fw-bold" id="next-btn" disabled>Próxima Pergunta</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}

<script text="text/javascript">

document.addEventListener('DOMContentLoaded', () => {

    const quizData = [
        {
            "questionNumber": 1,
            "question": "Com base na fórmula para o alcance de um projétil, $alcance = \\frac{velocidade^2 \\times \\sin(2 \\times angulo)}{gravidade}$, qual ângulo de lançamento (desconsiderando a resistência do ar) maximizaria o alcance?",
            "answerOptions": [
                {
                    "text": "$30^o$",
                    "isCorrect": false,
                    "rationale": "Embora $30^o$ e $60^o$ resultem no mesmo alcance, eles não produzem o alcance máximo. A função seno tem seu valor máximo igual a 1."
                },
                {
                    "text": "$45^o$",
                    "isCorrect": true,
                    "rationale": "O alcance máximo é obtido quando o valor de $\\sin(2 \\times angulo)$ é 1. Isso ocorre quando $2 \\times angulo = 90^o$, o que significa que o ângulo de lançamento é $45^o$."
                },
                {
                    "text": "$60^o$",
                    "isCorrect": false,
                    "rationale": "Embora $60^o$ e $30^o$ resultem no mesmo alcance, eles não produzem o alcance máximo. A função seno tem seu valor máximo igual a 1."
                },
                {
                    "text": "$90^o$",
                    "isCorrect": false,
                    "rationale": "Um ângulo de $90^o$ resulta em um lançamento vertical para cima. Neste caso, o alcance horizontal seria zero."
                }
            ],
            "hint": "Para que uma função seno atinja seu valor máximo de 1, qual deve ser o valor do seu argumento?"
        },
        {
            "questionNumber": 2,
            "question": "A simulação calcula a altura máxima do projétil usando a fórmula $altura_{maxima} = \\frac{velocidade^2 \\times (\\sin(angulo)^2)}{2 \\times gravidade}$. Se a velocidade inicial fosse de $30 m/s$ e o ângulo de lançamento de $30^o$ (considere $\\sin(30^o) = 0.5$), qual seria a altura máxima (use $g = 9.8 m/s^2$)?",
            "answerOptions": [
                {
                    "text": "$11,5 m$",
                    "isCorrect": true,
                    "rationale": "Aplicando os valores na fórmula, a altura máxima é $\\frac{30^2 \\times (0.5)^2}{2 \\times 9.8} = \\frac{900 \\times 0.25}{19.6} = \\frac{225}{19.6} \\approx 11.48$ metros."
                },
                {
                    "text": "$22,9 m$",
                    "isCorrect": false,
                    "rationale": "Este valor seria obtido se o denominador da equação fosse $g$ em vez de $2g$."
                },
                {
                    "text": "$45,9 m$",
                    "isCorrect": false,
                    "rationale": "Este valor seria obtido se o ângulo não fosse elevado ao quadrado e o denominador fosse $g$ em vez de $2g$."
                },
                {
                    "text": "$56,2 m$",
                    "isCorrect": false,
                    "rationale": "Este valor resultaria de um erro de cálculo, como não elevar o seno do ângulo ao quadrado."
                }
            ],
            "hint": "Lembre-se de seguir a ordem das operações e elevar ao quadrado o valor do seno do ângulo antes de multiplicar pela velocidade ao quadrado."
        },
        {
            "questionNumber": 3,
            "question": "A simulação usa a equação $tempo_{total} = \\frac{2 \\times velocidade \\times \\sin(angulo)}{gravidade}$. O que a variável 'tempo_total' representa no contexto da simulação?",
            "answerOptions": [
                {
                    "text": "O tempo que o projétil leva para atingir a altura máxima.",
                    "isCorrect": false,
                    "rationale": "O tempo para atingir a altura máxima é metade do tempo total de voo, pois a trajetória parabólica é simétrica."
                },
                {
                    "text": "O tempo total que o projétil permanece no ar antes de tocar o solo novamente.",
                    "isCorrect": true,
                    "rationale": "O tempo total de voo de um projétil é o tempo que ele leva para completar a sua trajetória, saindo do ponto inicial e retornando ao mesmo nível vertical."
                },
                {
                    "text": "O tempo que o projétil leva para percorrer a distância horizontal máxima.",
                    "isCorrect": false,
                    "rationale": "Isso descreve o alcance horizontal, que é medido em metros, não o tempo de voo, que é medido em segundos."
                },
                {
                    "text": "O tempo que o projétil leva para atingir o ponto de partida na mesma velocidade.",
                    "isCorrect": false,
                    "rationale": "Embora o projétil retorne à altura inicial, a velocidade vertical é a mesma em magnitude, mas na direção oposta, e a velocidade horizontal permanece constante."
                }
            ],
            "hint": "Pense no que a trajetória completa de um projétil significa em termos de tempo."
        }
    ];

    const questionElement = document.getElementById("question");
    const answerButtons = document.getElementById("answer-buttons");
    const nextButton = document.getElementById("next-btn");
    const feedbackArea = document.getElementById("feedback-area");
    const hintText = document.getElementById("hint-text");
    const rationaleAlert = document.getElementById("rationale-alert");
    const rationaleLabel = document.getElementById("rationale-label");
    const rationaleText = document.getElementById("rationale-text");
    const questionNumberElement = document.getElementById("question-number");
    const progressBar = document.getElementById("progress-bar");

    let currentQuestionIndex = 0;
    let score = 0;
    
    // Função auxiliar para renderizar o texto com KaTeX
    function renderContentWithKaTeX(element, content) {
        const regex = /\$(.*?)\$/g;
        let renderedContent = content.replace(regex, (match, p1) => {
            try {
                return katex.renderToString(p1, {
                    throwOnError: false
                });
            } catch (error) {
                console.error("Erro ao renderizar KaTeX:", error);
                return match; 
            }
        });
        element.innerHTML = renderedContent;
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        nextButton.innerHTML = "Próxima Pergunta";
        nextButton.disabled = true;
        displayQuestion();
    }

    function displayQuestion() {
        resetState();
        let currentQuestion = quizData[currentQuestionIndex];
        let questionNo = currentQuestionIndex + 1;
        questionNumberElement.textContent = `${questionNo}/${quizData.length}`;
        
        renderContentWithKaTeX(questionElement, currentQuestion.question);

        const progressPercentage = (questionNo / quizData.length) * 100;
        progressBar.style.width = progressPercentage + '%';
        progressBar.setAttribute('aria-valuenow', progressPercentage);

        currentQuestion.answerOptions.forEach((answer, index) => {
            const button = document.createElement("button");
            renderContentWithKaTeX(button, answer.text);
            button.classList.add("list-group-item", "list-group-item-action", "py-3", "mb-2", "rounded-3", "fw-medium");
            button.dataset.index = index; // Armazena o índice da resposta
            
            answerButtons.appendChild(button);
            if (answer.isCorrect) {
                button.dataset.isCorrect = "true";
            }
            button.addEventListener("click", selectAnswer);
        });

        hintText.textContent = currentQuestion.hint;
    }

    function resetState() {
        nextButton.disabled = true;
        feedbackArea.style.display = 'none';
        while (answerButtons.firstChild) {
            answerButtons.removeChild(answerButtons.firstChild);
        }
    }

    function selectAnswer(e) {
        const selectedBtn = e.target;
        const isCorrect = selectedBtn.dataset.isCorrect === "true";
        const currentQuestion = quizData[currentQuestionIndex];
        
        // Recupera o índice do botão clicado
        const selectedIndex = selectedBtn.dataset.index;

        feedbackArea.style.display = 'block';
        
        // Acessa a razão pelo índice
        const rationale = currentQuestion.answerOptions[selectedIndex].rationale;
        renderContentWithKaTeX(rationaleText, rationale);

        if (isCorrect) {
            selectedBtn.classList.add("list-group-item-success");
            rationaleAlert.classList.remove("alert-danger");
            rationaleAlert.classList.add("alert-success");
            rationaleLabel.textContent = "Correto: ";
            score++;
        } else {
            selectedBtn.classList.add("list-group-item-danger");
            rationaleAlert.classList.remove("alert-success");
            rationaleAlert.classList.add("alert-danger");
            rationaleLabel.textContent = "Incorreto: ";
        }

        Array.from(answerButtons.children).forEach(button => {
            if (button.dataset.isCorrect === "true") {
                button.classList.add("list-group-item-success");
            }
            button.disabled = true;
        });

        nextButton.disabled = false;
    }

    function showScore() {
        resetState();
        const cardBody = document.querySelector('.card-body');
        cardBody.innerHTML = `
            <h2 class="card-title text-center text-primary fw-bold">Quiz Concluído!</h2>
            <p class="fs-4 text-center mt-4">Você acertou ${score} de ${quizData.length} perguntas!</p>
            <div class="d-grid gap-2 mt-4">
                <button class="btn btn-primary fw-bold" id="restart-btn">Refazer Quiz</button>
            </div>
        `;
        document.getElementById("restart-btn").addEventListener("click", startQuiz);
    }

    function handleNextButton() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            displayQuestion();
        } else {
            showScore();
        }
    }

    nextButton.addEventListener("click", () => {
        if (currentQuestionIndex < quizData.length) {
            handleNextButton();
        } else {
            startQuiz();
        }
    });

    startQuiz();
});


</script>

{% endblock %}